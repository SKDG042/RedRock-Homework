##  数量较多的非法操作

> 比如用户连续刷新或点击，不在有效时间内参加活动

1. **`seckill\internal\api\middleware\ratelimit.go`** 基于 go-redis 限流，限制同一用户每秒内最高请求数为 100 以阻止恶意刷新
2. 同时在 **`internal\activity\data\activity.go`** 中添加自动更新活动状态函数，以验证活动的有效性

## 瞬时的高并发流量

1. 创建活动后将信息存入**Redis 缓存预热**，从 redis 缓存中读取信息，避免过多访问数据库
2. 通过**redis 限流**控制请求量
3. 采用**RabbitMQ 异步操作**，达到削峰的目的

## 库存的少卖或者超卖

1. **`seckill\internal\pkg\redis\lock.go`** 通过**分布式锁（悲观锁）**保证库存不会超卖
2. 依赖**lua 脚本的原子性**扣除库存, 防止多个请求同时修改导致库存不一致
3. **双重确定**，将扣除库存和确定订单操作分开，同时添加**订单定时恢复**，以防止库存扣除但订单未创建
